#! /bin/sh
#
# Start/Stop <%= @description %>
#
# chkconfig: 345 99 99
# description: <%= @description %>
# processname: <%= @exec %>
<% grep = @grep || "grep #{@title}" %>
title="<%= @title %>"
proc_bin="<%= @exec %>"
proc_args="<%= @args %>"
proc_log="<%= @log_dir %>/<%= @title %>.log"

find_proc () {
    PIDTEMP=`ps ux | <%= grep %> | awk '{ print $2 }'`
    # Pid not found
    if [ "x$PIDTEMP" = "x" ]; then
        PID=-1
    else
        PID=$PIDTEMP
    fi
}

start () {
    LOG_DIR=<%= @log_dir %>
    nohup ${proc_bin} ${proc_args} > ${proc_log} &
}

stop () {
    find_proc
    if [ $PID -ne -1 ]; then
        kill $PID
    fi
}

case $1 in
start)
        start
        ;;
stop)
        stop
        exit 0
        ;;
reload)
        stop
        start
        ;;
restart)
        stop
        start
        ;;
status)
    find_proc
    if [ $PID -gt 0 ]; then
        echo "<%= @description %> running"
            exit 0
        else
        echo "<%= @description %> not running"
            exit 1
    fi
        ;;
*)
        echo $"Usage: $0 {start|stop|restart|reload|status}"
        RETVAL=1
esac
exit 0